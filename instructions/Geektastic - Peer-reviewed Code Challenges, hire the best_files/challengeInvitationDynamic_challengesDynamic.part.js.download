(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{265:function(e,t,i){"use strict";i.r(t),i.d(t,"GEEKTASTIC",function(){return n}),i.d(t,"USERSOWNTEAM",function(){return l}),i.d(t,"ALL_EVALUATORS",function(){return s});const n="GEEKTASTIC",l="USERSOWNTEAM",s=[n,l]},403:function(e,t,i){"use strict";i.r(t),i.d(t,"DiffService",function(){return l});const n=/\r?\n/g;class l{getLineDiff(e,t){return i.e(45).then(i.t.bind(null,516,7)).then(i=>i.diffLines(e,t))}toCodeFileLines(e){const t=[];let i=0,l=0;for(let s of e){const e=s.value.split(n);t.push(e.map(function(e){const t={content:e,lnum:void 0,rnum:void 0};return s.added||(t.lnum=++i),s.removed||(t.rnum=++l),t}))}return Array.prototype.concat.apply([],t)}toExpandedLines(e){const t=[];let i=0,l=0;for(let s of e){const e=s.value.split(n);t.push(e.map(function(e){const t={content:e,lnum:void 0,rnum:void 0};return s.added||(t.lnum=++i),s.removed||(t.rnum=++l),t}))}return Array.prototype.concat.apply([],t)}}},405:function(e,t,i){"use strict";i.r(t),i.d(t,"SelectFile",function(){return o}),i.d(t,"SelectFileEvent",function(){return r});var n=i(0),l=i(6),s=i(18);class o extends l.View{constructor(){super(...arguments),this.selectFile=(()=>{const e=document.createElement("input");e.type="file",e.onchange=(()=>{e.files&&e.files.length&&this.emit(new r(e.files[0]))}),e.click()})}render(e){return Object(n.h)("div",{class:e.class,onClick:this.selectFile},e.children)}}class r extends s.ApplicationEvent{constructor(e){super(),this.file=e}}},474:function(e,t,i){"use strict";i.r(t),i.d(t,"SubmitChallengeSolutionController",function(){return m});var n=i(14),l=i(101),s=i(403),o=i(720),r=i(77),c=i(475),a=i(405),u=i(721),h=i(476),d=i(289),f=i(64),p=i(20),v=function(e,t,i,n){return new(i||(i=Promise))(function(l,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function r(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){e.done?l(e.value):new i(function(t){t(e.value)}).then(o,r)}c((n=n.apply(e,t||[])).next())})};class m extends n.Controller{constructor(e){super(new u.SubmitChallengeSolutionModel),this._diffService=new s.DiffService,this._fileService=new o.FileService,this._busyBehavior=new r.BusyBehaviour(this),this.setToggle=(()=>{this.model.hideIgnored=!this.model.hideIgnored}),this.onFileChanged=(e=>{this._fileService.readAsText(e.file).then(t=>this.setFileContent(e.codeFile,t)).then(()=>{this.model.isChanged=!0,this.model.triggerChange()})}),this.onFileDropped=(e=>{this.zipAdded(e.file)}),this.onZipSelected=(e=>{this.model.challengeInvitation.challenge.unconstrained?(this.model.isChanged=!0,this.model.selectedFile=e.file,this.model.triggerChange(!1)):this.zipAdded(e.file)}),this.model.showTitle=!1,this._publicChallengeInvitationService=new l.PublicChallengeInvitationService(e.invitationCode),this.onViewEvent(c.SubmitFileChangeEvent,this.onFileChanged),this.onViewEvent(h.FileDroppedEvent,this.onFileDropped),this.onViewEvent(a.SelectFileEvent,this.onZipSelected),this.onViewEvent(d.ToggleViewIgnoredFilesInZipEvent,this.setToggle),this._busyBehavior.busyOnLoading()}load(){return Promise.all([this._publicChallengeInvitationService.get().then(e=>{this.model.fromChallengeInvitation(e)}),this.loadRequiredDependencies()]).then(()=>this.buildLineContent())}loadRequiredDependencies(){i.e(26).then(i.t.bind(null,916,7)).then(e=>{this.JSZip=Object(p.unwrapImportedModuleDefault)(e)})}buildLineContent(){for(let e of this.model.files)e.newContent&&this.setFileContent(e,e.newContent)}setFileContent(e,t){return this._diffService.getLineDiff(e.content,t).then(i=>{e.newContent=t,e.lines=this._diffService.toCodeFileLines(i)})}onLoad(){Object(f.getHighlightService)()}submit(){return this.model.challengeInvitation.challenge.unconstrained?this.submitUnconstrained():this.submitConstrained()}submitUnconstrained(){return this._publicChallengeInvitationService.uploadSolution(this.model.selectedFile).then(()=>this._publicChallengeInvitationService.get())}submitConstrained(){const e=this.model.files.map(e=>({path:e.path,content:e.newContent||e.content,id:e.id}));return this._publicChallengeInvitationService.submitSolution(e).then(()=>this._publicChallengeInvitationService.get())}onSubmit(){this.model.validate(()=>{var e=this.submit().then(e=>{this.onSubmitted(e)});this._busyBehavior.wrapPromise(e)})}zipAdded(e){return v(this,void 0,void 0,function*(){if(!this.JSZip)throw new Error("loadDependencies not yet called");const t=yield this.JSZip.loadAsync(yield this._fileService.readAsArrayBuffer(e));yield this.processZipFiles(t.filter((e,t)=>!t.dir)),this.model.isChanged=!0,this.model.triggerChange()})}processZipFiles(e){const t=[];for(let i of e)for(let e of this.model.files)!i.name.startsWith("__MACOSX")&&i.name.endsWith(e.path)&&t.push(i.async("text").then(t=>this.setFileContent(e,t)));return Promise.all(t)}}},475:function(e,t,i){"use strict";i.r(t),i.d(t,"SubmitFileChangeEvent",function(){return l});var n=i(22);class l extends n.ViewEvent{constructor(e,t){super(),this.codeFile=e,this.file=t}}},476:function(e,t,i){"use strict";i.r(t),i.d(t,"FileDroppedEvent",function(){return l});var n=i(22);class l extends n.ViewEvent{constructor(e){super(),this.file=e}}},477:function(e,t,i){"use strict";i.r(t),i.d(t,"SubmitChallengeSolution",function(){return v});var n=i(0),l=i(12),s=i(476),o=i(32),r=i(7),c=i(16),a=i(723),u=i(59),h=i(289),d=i(405),f=i(482),p=i(13);class v extends l.ModelView{constructor(){super(...arguments),this.onDrop=(e=>{e.dataTransfer&&(e.preventDefault(),this.emit(new s.FileDroppedEvent(e.dataTransfer.files[0])))}),this.onDragOver=(e=>{e.preventDefault()}),this.zipFileSelect=(e=>{const t=e.target;t instanceof HTMLInputElement&&t.files&&t.files.length>0&&this.emit(new d.SelectFileEvent(t.files[0]))})}renderModelView(e){const t=e.timeRemaining&&Math.round(e.timeRemaining.asMinutes());return Object(n.h)("div",{id:"submitChallengeSolution",class:"container",onDrop:this.onDrop,onDragOver:this.onDragOver},Object(n.h)(o.default,{form:!0,busyIndicator:!0,busy:e.busy},e.showTitle&&Object(n.h)("h1",null,"Please submit your code for the files below")||null,Object(n.h)("div",{class:"select-zip file-select"},Object(n.h)("label",{for:"zipselect",class:"mui-btn mui-btn--primary custom-file-input"}),Object(n.h)(f.FileInput,{id:"zipselect",key:"solution-file-input",modelValue:new p.ModelValue(e,"selectedFile"),type:"file",accept:".zip",onchange:this.zipFileSelect,style:"visibility:hidden;"}),e.selectedFile&&Object(n.h)("span",{class:"selected-file-name"},e.selectedFile.name,Object(n.h)("i",{class:"icon icon-check"})),!e.selectedFile&&Object(n.h)("span",{class:"selected-file-name none"},"no file selected")),Object(n.h)("div",{class:"files"},e.files&&e.files.map((t,i)=>Object(n.h)(a.SubmitFile,{key:"submit-file-"+i,file:t,challengeInvitation:e.challengeInvitation}))),e.challengeInvitation.invitationState===u.SUBMITTED&&e.challengeInvitation.challenge.unconstrained&&!e.challengeInvitation.filesInZipMessage&&Object(n.h)(h.FilesInZip,{files:e.challengeInvitation.filesInZip||[],minutesRemaining:t,hideIgnored:e.hideIgnored}),e.challengeInvitation.filesInZipMessage&&Object(n.h)("ul",{class:"files-in-zip-message alert alert-danger"},e.challengeInvitation.filesInZipMessage.map(e=>Object(n.h)("li",null,e))),Object(n.h)(r.Row,null,Object(n.h)(c.Button,{disabled:!e.isChanged,class:"mui-btn mui-btn--primary mui--pull-right",type:"submit"},Object(n.h)("span",null,"Submit")))))}}},482:function(e,t,i){"use strict";i.r(t),i.d(t,"FileInput",function(){return l});var n=i(26);class l extends n.InputBase{getValue(e){const t=e.target;if(t instanceof HTMLInputElement&&"file"===t.type)return t.files&&t.files[0]||void 0}componentWillUnmount(){if(this.base){const e=this.base.querySelector("input");e&&(e.value="")}super.componentWillUnmount()}}},720:function(e,t,i){"use strict";i.r(t),i.d(t,"FileService",function(){return n});class n{readAsText(e){return new Promise(function(t,i){var n=new FileReader;n.onerror=i,n.onload=function(){t(n.result)},n.readAsText(e)})}readAsArrayBuffer(e){return new Promise(function(t,i){var n=new FileReader;n.onerror=i,n.onload=function(){t(n.result)},n.readAsArrayBuffer(e)})}}},721:function(e,t,i){"use strict";i.r(t),i.d(t,"SubmitChallengeSolutionModel",function(){return r});var n=i(36),l=i(9),s=i(61),o=i(11);class r extends l.ValidableModel{constructor(){super(...arguments),this.busy=!0,this.removedFileNames=[],this.showTitle=!0,this.isChanged=!1,this.hideIgnored=!1}fromChallengeInvitation(e){if(this.challengeInvitation=e,this.updateTimeRemaining(),e.challenge.unconstrained)this.files=[];else{var t=e.submissionCodeFiles,i=e.challenge.codeFiles,n={};for(var l of i)n[l.path]=l;this.files=t.length?t.filter(e=>{var t=n[e.path];return e.hasOwnProperty("content")&&t&&t.editable}).map(function(e){return e.newContent||(e.newContent=e.content,e.content=n[e.path].content),e}):[]}}updateTimeRemaining(){this.challengeInvitation&&n&&this.challengeInvitation.endAt&&(this.timeRemaining=n.duration(n(this.challengeInvitation.endAt).diff(n(o.Util.getServerTime()))).subtract(120,"seconds"))}}!function(e,t,i,n){var l,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var r=e.length-1;r>=0;r--)(l=e[r])&&(o=(s<3?l(o):s>3?l(t,i,o):l(t,i))||o);s>3&&o&&Object.defineProperty(t,i,o)}([Object(s.RequiredIf)(function(e){return e.challengeInvitation&&e.challengeInvitation.challenge.unconstrained})],r.prototype,"selectedFile",void 0)},723:function(e,t,i){"use strict";i.r(t),i.d(t,"SubmitFile",function(){return c});var n=i(0),l=i(318),s=i(6),o=i(405),r=i(475);class c extends s.View{constructor(){super(...arguments),this.onFileSelected=(e=>(this.emit(new r.SubmitFileChangeEvent(this.props.file,e.file)),!1))}componentDidMount(){this.onViewEvent(o.SelectFileEvent,this.onFileSelected)}render(e){return Object(n.h)("div",{class:"submit-code-file file"},Object(n.h)("div",{class:"head"},Object(n.h)("div",{class:"name"},Object(n.h)("h4",null,e.file.path)),Object(n.h)("div",{class:"status"}),Object(n.h)("div",{class:"actions"},Object(n.h)(o.SelectFile,{class:"mui-btn upload mui-btn--raised"},"Upload"))),e.file.lines&&Object(n.h)(l.ViewCodeFile,{challengeInvitation:e.challengeInvitation,codeFile:e.file,simple:!0}))}}}}]);